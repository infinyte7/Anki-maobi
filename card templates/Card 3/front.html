<div class="header">What is the <span class="question-sub-text">tone marks</span>?</div>

<br>
<div id="char_zhuyin">{{Zhuyin}}</div>
<div id="char_pinyin">{{Pinyin}}</div>
<div id="char_sim" class="char-card">{{Simplified}}</div>
<div id="char_trad" class="char-card">{{Traditional}}</div>

<script>
    // v1.0.0 - https://github.com/SimonLammer/anki-persistence/blob/eeb2e1a9e37c941dd63e1fe6c2a257f043c40e0d/script.js
    if(void 0===window.Persistence){var _persistenceKey="github.com/SimonLammer/anki-persistence/",_defaultKey="_default";if(window.Persistence_sessionStorage=function(){var e=!1;try{"object"==typeof window.sessionStorage&&(e=!0,this.clear=function(){for(var e=0;e<sessionStorage.length;e++){var t=sessionStorage.key(e);0==t.indexOf(_persistenceKey)&&(sessionStorage.removeItem(t),e--)}},this.setItem=function(e,t){null==t&&(t=e,e=_defaultKey),sessionStorage.setItem(_persistenceKey+e,JSON.stringify(t))},this.getItem=function(e){return null==e&&(e=_defaultKey),JSON.parse(sessionStorage.getItem(_persistenceKey+e))},this.removeItem=function(e){null==e&&(e=_defaultKey),sessionStorage.removeItem(_persistenceKey+e)})}catch(e){}this.isAvailable=function(){return e}},window.Persistence_windowKey=function(e){var t=window[e],n=!1;"object"==typeof t&&(n=!0,this.clear=function(){t[_persistenceKey]={}},this.setItem=function(e,n){null==n&&(n=e,e=_defaultKey),t[_persistenceKey][e]=n},this.getItem=function(e){return null==e&&(e=_defaultKey),null==t[_persistenceKey][e]?null:t[_persistenceKey][e]},this.removeItem=function(e){null==e&&(e=_defaultKey),delete t[_persistenceKey][e]},null==t[_persistenceKey]&&this.clear()),this.isAvailable=function(){return n}},window.Persistence=new Persistence_sessionStorage,Persistence.isAvailable()||(window.Persistence=new Persistence_windowKey("py")),!Persistence.isAvailable()){var titleStartIndex=window.location.toString().indexOf("title"),titleContentIndex=window.location.toString().indexOf("main",titleStartIndex);titleStartIndex>0&&titleContentIndex>0&&titleContentIndex-titleStartIndex<10&&(window.Persistence=new Persistence_windowKey("qt"))}}
</script>    

<script>

    var switchIdList = ["text-pinyin", "text-zhuyin", "text-meaning", "text-sim", "text-trad"];
    function initSwitchPrefs() {
        for (var _id of switchIdList) {
            var divId = _id.replace("text-", "char_");
            if (Persistence.getItem(_id) == "false") {
                document.getElementById(divId).style.display = "none";
            }
        }
    }
    
    if (Persistence.isAvailable()) {
        if (document.querySelector(".win")) {
            initSwitchPrefs();
        } else {
            window.addEventListener("load", initSwitchPrefs, false);
        }
    }

    var pinyinList = document.getElementById("char_pinyin").children;
    var pinyinQuestionList = []
    for (var pinyin of pinyinList) {
        var removedTone  = removeToneMarks(pinyin);
        if (!pinyinQuestionList.includes(removedTone)) {
            pinyinQuestionList.push(removedTone)
        }
    }
    document.getElementById("char_pinyin").innerText = pinyinQuestionList.join(", ");

    var zhuyinList = document.getElementById("char_zhuyin").children;
    var zhuyinQuestionList = []
    for (var zhuyin of zhuyinList) {
        zhuyin.innerText = zhuyin.innerText.replace("ˋ", "");
        zhuyin.innerText = zhuyin.innerText.replace("ˊ", "");
        zhuyin.innerText = zhuyin.innerText.replace("˙", "");
        zhuyin.innerText = zhuyin.innerText.replace("ˇ", "");

        if (!zhuyinQuestionList.includes(zhuyin.innerText)) {
            zhuyinQuestionList.push(zhuyin.innerText)
        }
    }

    document.getElementById("char_zhuyin").innerText = zhuyinQuestionList.join(", ");

    function removeToneMarks(pinyin) {
        pinyin = pinyin.innerText.toLowerCase();

        var pinyinTones = {
            'a': ['ā', 'á', 'ǎ', 'à'],
            'e': ['ē', 'é', 'ě', 'è'],
            'i': ['ī', 'í', 'ǐ', 'ì'],
            'o': ['ō', 'ó', 'ǒ', 'ò'],
            'u': ['ū', 'ú', 'ǔ', 'ù', 'ǖ', 'ǘ', 'ǚ', 'ǜ', 'ü']
        };

        for (const [key, value] of Object.entries(pinyinTones)) {
            value.map((e) => {
                for (char of pinyin) {
                    if (char.includes(e)) {
                        pinyin = pinyin.replace(e, key)
                    }
                }
            })
        }
        return pinyin;
    }
</script>