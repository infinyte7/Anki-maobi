<div class="header">What is the <span class="question-sub-text">tone marks</span>?</div>

<br>
<div id="char_zhuyin">{{Zhuyin}}</div>
<div id="char_pinyin">{{Pinyin}}</div>
<div id="char_sim" class="char-card">{{Simplified}}</div>
<div id="char_trad" class="char-card">{{Traditional}}</div>

<script>
// v1.0.0 - https://github.com/SimonLammer/anki-persistence/blob/eeb2e1a9e37c941dd63e1fe6c2a257f043c40e0d/script.js
if(void 0===window.Persistence){var e="github.com/SimonLammer/anki-persistence/",t="_default";if(window.Persistence_localStorage=function(){var i=!1;try{null!==window.localStorage&&"object"==typeof window.localStorage&&(i=!0,this.clear=function(){for(var t=0;t<localStorage.length;t++){var i=localStorage.key(t);0==i.indexOf(e)&&(localStorage.removeItem(i),t--)}},this.setItem=function(i,n){void 0==n&&(n=i,i=t),localStorage.setItem(e+i,JSON.stringify(n))},this.getItem=function(i){return void 0==i&&(i=t),JSON.parse(localStorage.getItem(e+i))},this.removeItem=function(i){void 0==i&&(i=t),localStorage.removeItem(e+i)})}catch(n){}this.isAvailable=function(){return i}},window.Persistence_sessionStorage=function(){var i=!1;try{"object"==typeof window.sessionStorage&&(i=!0,this.clear=function(){for(var t=0;t<sessionStorage.length;t++){var i=sessionStorage.key(t);0==i.indexOf(e)&&(sessionStorage.removeItem(i),t--)}},this.setItem=function(i,n){void 0==n&&(n=i,i=t),sessionStorage.setItem(e+i,JSON.stringify(n))},this.getItem=function(i){return void 0==i&&(i=t),JSON.parse(sessionStorage.getItem(e+i))},this.removeItem=function(i){void 0==i&&(i=t),sessionStorage.removeItem(e+i)})}catch(n){}this.isAvailable=function(){return i}},window.Persistence_windowKey=function(i){var n=window[i],o=!1;"object"==typeof n&&(o=!0,this.clear=function(){n[e]={}},this.setItem=function(i,o){void 0==o&&(o=i,i=t),n[e][i]=o},this.getItem=function(i){return void 0==i&&(i=t),void 0==n[e][i]?null:n[e][i]},this.removeItem=function(i){void 0==i&&(i=t),delete n[e][i]},void 0==n[e]&&this.clear()),this.isAvailable=function(){return o}},window.Persistence=new Persistence_localStorage,Persistence.isAvailable()||(navigator.userAgent.indexOf("Mobile")>0?window.Persistence=new Persistence_sessionStorage:window.Persistence=new Persistence_windowKey("py")),!Persistence.isAvailable()){var i=window.location.toString().indexOf("title"),n=window.location.toString().indexOf("main",i);i>0&&n>0&&n-i<10&&(window.Persistence=new Persistence_windowKey("qt"))}}
</script>

<script>

    var switchIdList = ["text-pinyin", "text-zhuyin", "text-meaning", "text-sim", "text-trad"];
    function initSwitchPrefs() {
        for (var _id of switchIdList) {
            var divId = _id.replace("text-", "char_");
            if (Persistence.getItem("back" + _id) == "false") {
                document.getElementById(divId).style.display = "none";
            }
        }
    }
    
    if (Persistence.isAvailable()) {
        if (window.ankiPlatform == "desktop" || !isInWebView()) {
            initSwitchPrefs();
        } else {
            window.addEventListener("load", initSwitchPrefs, false);
        }
    }

    var pinyinList = document.getElementById("char_pinyin").children;
    var pinyinQuestionList = []
    for (var pinyin of pinyinList) {
        var removedTone  = removeToneMarks(pinyin);
        if (!pinyinQuestionList.includes(removedTone)) {
            pinyinQuestionList.push(removedTone)
        }
    }
    document.getElementById("char_pinyin").innerText = pinyinQuestionList.join(", ");

    var zhuyinList = document.getElementById("char_zhuyin").children;
    var zhuyinQuestionList = []
    for (var zhuyin of zhuyinList) {
        zhuyin.innerText = zhuyin.innerText.replace("ˋ", "");
        zhuyin.innerText = zhuyin.innerText.replace("ˊ", "");
        zhuyin.innerText = zhuyin.innerText.replace("˙", "");
        zhuyin.innerText = zhuyin.innerText.replace("ˇ", "");

        if (!zhuyinQuestionList.includes(zhuyin.innerText)) {
            zhuyinQuestionList.push(zhuyin.innerText)
        }
    }

    document.getElementById("char_zhuyin").innerText = zhuyinQuestionList.join(", ");

    function removeToneMarks(pinyin) {
        pinyin = pinyin.innerText.toLowerCase();

        var pinyinTones = {
            'a': ['ā', 'á', 'ǎ', 'à'],
            'e': ['ē', 'é', 'ě', 'è'],
            'i': ['ī', 'í', 'ǐ', 'ì'],
            'o': ['ō', 'ó', 'ǒ', 'ò'],
            'u': ['ū', 'ú', 'ǔ', 'ù', 'ǖ', 'ǘ', 'ǚ', 'ǜ', 'ü']
        };

        for (const [key, value] of Object.entries(pinyinTones)) {
            value.map((e) => {
                for (char of pinyin) {
                    if (char.includes(e)) {
                        pinyin = pinyin.replace(e, key)
                    }
                }
            })
        }
        return pinyin;
    }
    
    function isInWebView() {
        var UA = navigator.userAgent;
        if (/Windows/i.test(UA) || /Macintosh/i.test(UA) || (/Linux/i.test(UA) && !/Android/i.test(UA))) {
            // document.getElementById("plecoMobile").style.display = "none";
            if (/QtWebEngine/i.test(UA)) {
                return true;
            }
        } else if (/Android/i.test(UA)) {
            if (/wv/i.test(UA)) {
                return true;
            }
        } else if (/iPhone|iPod|iPad/.test(UA)) {
            if (/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(UA)) {
                return true;
            }
        } else {
            return true;
        }
        return false;
    }
</script>